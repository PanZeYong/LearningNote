# 变量的解构赋值

## 一、理解解构（Destructuring）

ES6 允许按照一定的模式，从对象和数组提取值，相应地赋值给对应的变量，简单来说，只要等号两边的模式相匹配，变量就会被赋予相应的值，我们把它称为**解构**赋值。

## 二、支持变量解构的数据类型

### 1、数组的解构赋值

#### 解构赋值类型

- 完全解构：等号左右两边的模式相匹配，变量被赋予相应的值。

```javascript
let [x, y] = [1, 2]
```

- 不完全解构：等号左边的模式只匹配等号右边数组的一部分，这种情况解构是成功的。

```javascript
let [x, y] = [1, 2, 3]
```

#### 解构满足的条件

- 等号右边的数据结构具有 Iterator 接口，否则会报错；

- Set 结构也可以使用数组解构赋值。

#### 默认值

解构赋值允许指定默认值，默认值生效的条件：ES6 内部使用严格相等运算符 `===` 来判断一个位置是否有值，因此，只有当数组中的成员严格等于 `undefined`，默认值才会生效。

```javascript
let [x = 1] = [undefined]    // x: 1

let [x = 1] = [null]    // x: null
```

默认值可以是一个**表达式**，但是该表达式是**惰性**求值的，只有当用到

的时候，才会使用。

```javascript
function example() {
	console.log("默认值可是一个表达式");
}

let [x = example()] = [1];    // 此时因为变量 x 能取到值 1，使得函数 example 不会被执行。
```

默认值可以引用解构赋值的其它变量，前提是这些变量被声明。

### 2、对象的解构赋值

与数组的解构赋值相比，有一点明显不同的是与对象属性的顺序没有关系，变量必须与属性名相同，才能获取相应的值。对象的解构赋值的真正形式如下：

```javascript
let {a: b, c: d} = {a: "test", c: "str"}
```

a，b 是匹配模式，而 b，d 才是变量，被赋值的是后者，而不是前者。对象的解构赋值有简洁的表达形式，如下：

```javascript
let {a, c} = {a: "test", c: "str"}
```

这种表达形式必须满足的条件是变量名与属性名必须相同。

解构也可以用于嵌套结构的对象

对象的解构也可以指定默认值，与数组的解构一样，默认值生效的条件是对象的属性值严格等于 `undefined`。

#### 注意点

- 如果解构模式是嵌套的对象，并且子对象所在的父属性不存在，这种情况下会报错。

```javascript
// 报错
let {foo: {bar}} = {baz: 'baz'};
```

- 如果将一个已经声明的变量用于解构赋值，那么此时就得小心，有可能会报错。

```javascript
// 报错
let x = 5;
{x} = {x: 8}

// 正确写法
({x} = {x:8})
```

JavaScript 引擎会将以大括号开头的代码解析成代码块，从而造成语法错误。要避免此错误的发生，则将其放在圆括号里面。

### 3、字符串的解构赋值

字符串解构赋值时，会被转换成一个类似字数组的对象。

```javascript
let [a, b, c, d, e, f] = ["script"];
```

### 4、数值和布尔值的解构赋值

如果等号右边的值不是数组或者对象时，在解构时，会将其先转换为对象。但是有比较特殊的情况是无法转换为对象，即 `null` 和 `undefined`，因此对它们解构赋值时是会报错的。

```javascript
let {s: toString } = 123;

=>

var _ = 123,
    s = _.toString;
```

### 5、函数参数的解构赋值

```javascript
// 为 x、y 指定默认值
function move({x = 0, y = 0} = {}) {
  return [x, y];
}

move({})    // [0, 0]

// 为 move 参数指定默认值
function move({x, y} = { x: 0, y: 0 }) {
  return [x, y];
}

move({})    // [undefined, undefined]
```

## 三、圆括号问题

### 1、不能使用圆括号的情况

- 变量声明语句；

- 函数参数；

- 赋值语句的模式。

### 2、可以使用圆括号的情况

赋值语句的非模式部分，可以使用圆括号。

```javascript
[(a)] = [8]; // 正确
({ p: (d) } = {}); // 正确
[(parseInt.prop)] = [3]; // 正确
```

## 四、用途

- 交换变量；

- 从函数返回多个值；

- 函数参数的定义；

- 提取 JSON 数据；

- 函数参数的默认值；

- 遍历 Map 结构；

- 输入模块的指定方法。

### [参考来源](http://es6.ruanyifeng.com/#docs/destructuring)



