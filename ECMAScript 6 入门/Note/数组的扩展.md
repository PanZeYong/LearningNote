# 数组的扩展

## 一、扩展运算符

### 1、含义及用法

扩展运算符（spread）使用 `...` 来表示，将一个数组转化为用逗号隔开的参数序列。

```javascript
console.log(...[1, 2, 3, 4]);    // 1 2 3 4
```

扩展运算符的用法：

- 用于函数调用；（用于数组 `push` 方法）

- 与正常的函数参数结合使用；

- 扩展运算符后面可以放置表达式；

- 扩展运算符后面是一个空数组，则不会产生任何效果；

- 扩展运算符放在圆括号里面的前提是函数调用，否则会报错；

- 替代函数 `apply` 方法。

### 2、应用场景

- 复制数组：数组 `a2` 是 `a1` 的克隆版本，在 ES5 中复制数组可以使用方法 `concat()`，但是如果复制的元素是对象或者数组，那么只复制其对象引用到新的数组，即新旧数组都指向同一个内存地址；如果复制的元素是字符串、整型等基本数据类型，则会把这些值拷贝到新数组，修改新数组的值不会影响到旧数组的值。对于扩展运算符 `...` 也是一样的，都是**浅拷贝**。

	```javascript
	const a1 = [1, 2, 3];
	// 第一种写法
	const a2 = [...a1]
	// 第二种写法
	const [...a2] = a1;
	```
	
- 合并数组：对于对象或者数组类型的合并，元素的拷贝都是浅拷贝的。

- 与解构赋值合并：需要注意的是如果是用于数组赋值，只能放在参数的最后一位。

- 字符串：将字符串转换为真正的数组，并且能正确识别四个字节的 Unicode 字符。

- 实现了 Iterator 接口的对象：将类似数组的对象转换为真正的数组。对于没有实现 Iterator 接口的对象，可以使用方法 `Array.from` 将其转换为真正的数组。

- Map 和 Set 结构，Generator 函数

## 二、数组 Array 方法

### 1、Array.from（浅拷贝）

#### 定义

将类似数组的对象（array-like-object）和可遍历（iterable）的对象（包括 ES6 新增的数据结构 `Set` 和 `Map`）转换为真正的数组。

类似数组的对象，本质特征只有一点，那就是必须要有 `length` 属性。因此，凡是具有 `length` 属性的对象，都可以使用 `Array.from()` 方法转换为真正的数组，而扩展运算符则不可以，其背后调用的逻辑是遍历器接口。

```javascript
// 类似数组的对象
let arrayLike = {
    '0': 'a',
    '1': 'b',
    '2': 'c',
    length: 3
};

Array.from(arrayLike);
```

`Array.from()` 方法可以接收三个参数：

- `arrayLike`：要转换成真正数组的类似数组的对象或者可遍历对象；

- `mapFn`：类似 `map` 方法的功能，可以对每个元素进行处理，将处理后的值放入返回的数组；

- `thisArg`：执行回调函数 `mapFn` 的 `this` 对象。

#### 应用

- 将字符串转换为数组，并且返回字符串的长度。`Array.from` 方法可以正确处理各种字符，包括 4 字节的字符。

### 2、Array.of

将一组值转换数组，可以用来弥补 `Array()` 构造函数的不足，即参数个数不同会导致 `Array()` 的行为差异。

```javascript
Array.of((1, 2, 3, 4));    // [1, 2, 3, 4]

// 模拟实现 Array.of
function ArrayOf(){
  return [].slice.call(arguments);
}
```

## 三、数组实例的方法

### 1、copyWithin()

在当前数组的内部，将指定位置的数组元素复制到其它位置（覆盖数组元素），返回当前数组。也就是说，通过这样的操作，会改变当前数组。该方法接收三个参数：

- `target`：必须参数，从该位置开始替换数组元素。如果为负值，表示倒数；

- `start`：可选参数，从该位置开始读取数据，默认值为 0。如果为负值，表示倒数；

- `end`：可选参数，到该位置**前**停止读取数据，默认等于数组长度。如果为负值，表示倒数。

这三个参数应该都是数值。

```javascript
[1, 2, 3, 4, 5, 6, 7].copyWithin(0, 4, 6);    // [5, 6, 3, 4, 5, 6, 7]

// 模拟 copyWithin 实现
[].copyWithin.call(new Int32Array([1, 2, 3, 4, 5]), 0, 3, 4);
```

### 2、find() 和 findIndex()

#### find()

用于找出第一个符合条件的的数组成员，如果符合条件的话，则返回该数组成员；否则返回 `undefined`。它接收两个参数：一个回调函数，每个数组成员都要执行该回调函数，而该回调函数又接收三个参数：

- `value`：当前的数组成员；

- `index`：当前的位置；

- `arr`：数组。

另一个参数是绑定回调函数的 `this` 对象。

```javascript
[1, 5, 10, 15].find((value, index, arr) => {
  return value > 9;
}) // 10
```

#### findIndex()

找出符合第一个条件的数组成员的索引，如果符合条件的话，则返回相应的索引值；否则返回 -1。接收的参数与 `find()` 一样。

```javascript
[1, 5, 10, 15].findIndex((value, index, arr) => {
  return value > 9;
}) // 10
```

这两个方法的好处是可以发现 `NaN`，通过方法 `Object.is()`，这样可以弥补 `indexOf` 方法的不足。

```javascript
[NaN].findIndex(y => Object.is(NaN, y))    // true
```

### 3、fill()

使用给定的值来填充数组，对于填充类型是引用类型，比如对象时，被赋值的是对象的内存地址，即数组的元素指向的都是同一个对象的内存地址。（浅拷贝）接收三个参数：

- `value`：填充值；

- `start`：填充的起始位置；

- `end`：填充结束位置前。

```javascript
['a', 'b', 'c'].fill(7, 1, 2)    // ['a', 7, 'c']
```

### 4、entries()、keys() 和 values()

#### entries()

用于遍历数组，对键值的遍历，返回一个遍历器对象，可以使用 `for...of` 进行循环遍历。

#### keys()

用于遍历数组，对键名的遍历，返回一个遍历器对象，可以使用 `for...of` 进行循环遍历。

#### values()

用于遍历数组，对键值的遍历，返回一个遍历器对象，可以使用 `for...of` 进行循环遍历。

### 5、includes

表示某个数组是否包含给定的值，返回一个布尔值。接收两个参数：

- `value`：给定值，即是否包含在数组的值；

- `index`：搜索的位置，默认为 0。如果为负数，则表示倒数的位置；若大于数组的长度，则重置为 0。

```javascript
[1, 2, 3, 4].includes(3);
```

Map 和 Set 数据结构的 `has` 方法与 `includes` 区分：

- Map 结构的 `has` 方法，用于查找键名。比如 `Map.prototype.has(key)`、`WeakMap.prototype.has(key)`、`Reflect.has(target, propertyKey)`。

- Set 结构的 `has` 方法，用于查找键值。比如 `WeakSet.prototype.has(value)`、`Set.prototype.has(value)`。

### 6、flat() 和 flatMap()

#### flat()

数组中有些元素是数组，可以将嵌套的数组 “拉平”，变成一维数组，返回新的数组，不改变原数组。可以接收一个参数：表示拉平的层数，默认是 1，`Infinity` 表示不管嵌套了多少层，都将其拉平。

```javascript
[1, 2, [3, 4]].flat();    // [1, 2, 3, 4]
```

如果原数组有空位，则直接跳过空位。

#### flatMap()

对原数组的每个成员都执行一个回调函数，相当于 `Map` 操作，然后再对返回值组成的数组执行 `flat` 操作，返回新数组，不改变原数组。回调函数接收三个参数：

- `currentValue`：当前数组成员；

- `currentIndex`：当前数组成员的位置；

- `array`：原数组。

此外，`flatMap` 还可以接收第二个参数，用来绑定回调函数的 `this`。

```javascript
// 相当于 [[2, 4], [3, 6], [4, 8]].flat()
[2, 3, 4].flatMap((x) => [x, x * 2])
// [2, 4, 3, 6, 4, 8]
```

## 四、数组的空位

数组的空位是指数组的某一个位置没有任何值，要注意的是空位不是 `undefined`，一个位置的值等于 `undefined`，依然是有值的。

ES5 对空位的处理：

- `forEach()`、`filter()`、`reduce()`、`every()` 和 `some()` 都会跳过空位。

- `map()` 会跳过空位，但是会保留该值。

- `join()` 和 `toString()` 会将空位视为 `undefined`，而 `undefined` 和 `null` 会被处理成空字符串。

ES6 则明确将空位转为 `undefined`。包括 `Array.from()`、`...`、`entries()`、`keys()`、`values()`、`find()` 和 `findIndex()`。此外，`copyWithin()` 会连空位一起复制，`for...of` 会循环遍历空位和 `fill()` 会将空位视为数组的正常位置。

### [参考链接](http://es6.ruanyifeng.com/#docs/array#%E6%95%B0%E7%BB%84%E5%AE%9E%E4%BE%8B%E7%9A%84-entries%EF%BC%8Ckeys-%E5%92%8C-values)